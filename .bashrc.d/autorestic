if command -v autorestic >/dev/null 2>&1
then
    . <(autorestic completion bash)
fi

function __autorestic_cleanup() {
    rm -f $autorestic_config
}

function __autorestic() {
    autorestic_config=$(mktemp --suffix=.yml)
    gopass autorestic/config/$(hostname) > $autorestic_config
    command autorestic -c $autorestic_config $@
}

function autorestic() {
    trap __autorestic_cleanup RETURN
    __autorestic $@
}
